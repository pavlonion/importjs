<!doctype html>
<html>
<body>
	<div id="timer">0</div>
	<script>
	(function main() {
		if (typeof window.CustomEvent != "function") {
			window.CustomEvent = function(event, params) {
				var default_params = { bubbles: false, cancelable: false, detail: undefined };

				for (var key in default_params) {
					if (typeof params[key] == "undefined") {
						params[key] = default_params[key];
					}
				}

				console.log(params);
				var evt = document.createEvent("CustomEvent");
				evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);
				return evt;
			}

			window.CustomEvent.prototype = Object.create(window.Event.prototype);
		}

		var link = document.querySelector("link[rel=import]");
		var native_import_support = "import" in link;

		function startup() {
			var timer = link.import.querySelector("#timer");
			var interval = setInterval(function() { timer.innerHTML++; }, 1000);

			document.dispatchEvent(new CustomEvent("timer_widget_ready", {
				detail: {
					element: timer,
					interval: interval
				}
			}));
		}

		if (native_import_support) {
			startup();

		} else{
			document.addEventListener("WebComponentsReady", startup);
		}
	})();
	</script>
</body>
</html>
